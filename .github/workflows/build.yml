name: Build

on:
  push:
  pull_request:
    branches:
      - 'master'

jobs:
  test:
    strategy:
      matrix:
        os: [ ubuntu-16.04, ubuntu-22.04 ]
        php: [ 5.6, 8.1, 8.2 ]

    runs-on: ${{ matrix.os }}

    steps:
      - name: Set up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php }}
          extensions: json, mbstring, openssl, pdo, pdo_mysql, mailparse, iconv, gd, zlib, curl, xml, simplexml, dom, calendar, gettext, zip, tidy, intl

      - name: Build Swig
        run: |
          git clone https://github.com/swig/swig.git
          cd swig
          mkdir Build
          cd Build
          cmake ..
          make
          sudo make install
          swig -version # check to make sure swig version 4.1.0 before continuing

      - name: Build PDFTron
        run: |
          mkdir wrappers_build # Make a directory to build the wrappers in.
          cd wrappers_build # Move to that directory.
          
          git clone https://github.com/PDFTron/PDFNetWrappers # Git the code.
          cd PDFNetWrappers/PDFNetC # Move to where we download PDFNet.
          
          wget https://www.pdftron.com/downloads/PDFNetC64.tar.gz # Download PDFNet.
          tar xzvf PDFNetC64.tar.gz # Unpack PDFNet.
          mv PDFNetC64/Headers/ . # Move PDFNet Headers/ into place.
          mv PDFNetC64/Lib/ . # Move PDFNet Lib/ into place.
          cd .. # Go back up.
          mkdir Build # Create a directory to create the Makefiles in.
          cd Build # Move to that directory.
          cmake -D BUILD_PDFNetPHP=ON .. # Create the Makefiles with CMake.
          make # Build the PHP wrappers with SWIG.
          sudo make install # Copy the PHP wrappers to where the samples can find them.
          
          ls -al
